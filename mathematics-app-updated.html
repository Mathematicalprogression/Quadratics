<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uhm welcome i guess</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* Password Screen Styles */
        .password-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .password-screen.hidden {
            display: none;
        }

        .access-box {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 50px 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .access-box h1 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 14px;
            margin-bottom: 30px;
            font-style: italic;
        }

        .info-text {
            color: #555;
            font-size: 15px;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .access-box input {
            width: 100%;
            padding: 15px 20px;
            margin: 15px 0;
            border: 2px solid #ddd;
            border-radius: 12px;
            font-size: 16px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .access-box input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .access-box button {
            width: 100%;
            padding: 15px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .access-box button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .emoji {
            font-size: 3em;
            margin-bottom: 20px;
        }

        /* Chat App Styles */
        .container {
            max-width: 800px;
            width: 100%;
            margin: 0 auto;
            background: white;
            height: 100vh;
            display: none;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .container.active {
            display: flex;
        }

        .header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 15px 20px;
            text-align: center;
        }

        .security-badge {
            font-size: 11px;
            opacity: 0.9;
            background: rgba(255,255,255,0.2);
            padding: 4px 8px;
            border-radius: 4px;
            margin-top: 5px;
            display: inline-block;
        }

        .join-screen {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .join-screen h2 {
            margin-bottom: 10px;
            color: #333;
        }

        .privacy-notice {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border: 2px solid #f093fb;
            color: #333;
            padding: 12px;
            border-radius: 12px;
            margin-bottom: 20px;
            max-width: 400px;
            font-size: 14px;
            text-align: center;
        }

        .privacy-notice strong {
            display: block;
            margin-bottom: 5px;
        }

        .join-screen input {
            width: 100%;
            max-width: 300px;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
            text-transform: uppercase;
        }

        .join-screen button {
            width: 100%;
            max-width: 300px;
            padding: 12px;
            font-size: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .join-screen button:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            transform: scale(1.05);
            transition: all 0.3s ease;
        }

        .chat-screen {
            display: none;
            flex: 1;
            flex-direction: column;
            height: 100%;
        }

        .chat-screen.active {
            display: flex;
        }

        .room-info {
            background: #f9f9f9;
            padding: 10px 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .room-code {
            font-weight: bold;
            color: #f093fb;
        }

        .encryption-indicator {
            font-size: 12px;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .leave-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #fafafa;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .message.own {
            align-items: flex-end;
        }

        .message-bubble {
            max-width: 70%;
            padding: 10px 15px;
            border-radius: 18px;
            word-wrap: break-word;
            position: relative;
            cursor: pointer;
            user-select: none;
        }

        .message.own .message-bubble {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.other .message-bubble {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-bottom-left-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .reply-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0,0,0,0.1);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s;
            font-size: 14px;
        }

        .message.own .reply-arrow {
            left: -30px;
        }

        .message.other .reply-arrow {
            right: -30px;
        }

        .message:hover .reply-arrow {
            opacity: 1;
        }

        .reply-arrow:hover {
            background: rgba(0,0,0,0.2);
        }

        .replied-message {
            background: rgba(0,0,0,0.1);
            padding: 8px 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 13px;
            border-left: 3px solid rgba(255,255,255,0.5);
        }

        .replied-message-text {
            opacity: 0.9;
            font-style: italic;
        }

        .replying-to-banner {
            background: rgba(102, 126, 234, 0.1);
            padding: 10px 15px;
            border-left: 3px solid #667eea;
            margin: 10px 15px 0;
            border-radius: 4px;
            display: none;
            align-items: center;
            justify-content: space-between;
        }

        .replying-to-banner.active {
            display: flex;
        }

        .replying-to-text {
            font-size: 13px;
            color: #555;
            font-style: italic;
            flex: 1;
        }

        .cancel-reply {
            background: none;
            border: none;
            color: #e74c3c;
            cursor: pointer;
            padding: 5px 10px;
            font-size: 18px;
        }

        .message img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            margin-top: 5px;
            cursor: pointer;
        }

        .timestamp {
            font-size: 11px;
            color: #999;
            margin-top: 4px;
        }

        .input-area {
            padding: 15px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
        }

        .input-area input[type="text"] {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 15px;
        }

        .input-area button {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
        }

        .input-area button:hover {
            background: linear-gradient(135deg, #00f2fe 0%, #4facfe 100%);
            transform: scale(1.05);
            transition: all 0.3s ease;
        }

        .file-input-label {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 10px;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 40px;
        }

        .file-input-label:hover {
            background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%);
            transform: scale(1.05);
            transition: all 0.3s ease;
        }

        input[type="file"] {
            display: none;
        }

        .status {
            text-align: center;
            padding: 8px;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #333;
            font-size: 14px;
        }

        .status.connected {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .join-screen .info-text {
            margin-top: 15px;
            color: #666;
            font-size: 13px;
            text-align: center;
            max-width: 400px;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <!-- Password Screen -->
    <div class="password-screen" id="passwordScreen">
        <div class="access-box">
            <div class="emoji">üìù</div>
            <h1>MATHEMATICS</h1>
            <p class="subtitle">Please Note That some topics may not be available currently</p>
            <p class="info-text">Enter what Topic you Want</p>
            <input type="password" id="topicInput" placeholder="topic..." autocomplete="off">
            <button onclick="checkPassword()">Begin</button>
        </div>
    </div>

    <!-- Chat App Container -->
    <div class="container" id="chatContainer">
        <div class="header">
            <h1>üí¨ yoooooooooo</h1>
            <div class="security-badge">who let me cook this soft</div>
        </div>

        <!-- Join Screen -->
        <div class="join-screen" id="joinScreen">
            <h2>drop ur room code ‚ú®</h2>
            <div class="privacy-notice">
                <strong>üîí totally private btw</strong>
                everything's encrypted so only u and me can see the msgs. no one else can read ts even if they tried lol
            </div>
            <input type="text" id="roomCodeInput" placeholder="room code here..." maxlength="20">
            <button onclick="joinRoom()">les go üöÄ</button>
            <p class="info-text">
                we just need to have the same room code. (also i may have used some AI).
            </p>
        </div>

        <!-- Chat Screen -->
        <div class="chat-screen" id="chatScreen">
            <div class="room-info">
                <div>
                    <span>room: <span class="room-code" id="currentRoom"></span></span>
                    <div class="encryption-indicator">üîê locked down</div>
                </div>
                <button class="leave-btn" onclick="leaveRoom()">ily cya</button>
            </div>
            <div class="status" id="status">connecting...</div>
            <div class="replying-to-banner" id="replyingBanner">
                <span class="replying-to-text" id="replyingToText">Replying to: Message...</span>
                <button class="cancel-reply" onclick="cancelReply()">‚úï</button>
            </div>
            <div class="messages" id="messages"></div>
            <div class="input-area">
                <label for="imageInput" class="file-input-label">üìé</label>
                <input type="file" id="imageInput" accept="image/*" onchange="handleImageUpload()">
                <input type="text" id="imageUrlInput" placeholder="paste image link...">
                <input type="text" id="messageInput" placeholder="say something..." onkeypress="handleKeyPress(event)">
                <button onclick="sendMessage()">send it</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- CryptoJS for encryption -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

    <script>
        // ‚ö†Ô∏è PASSWORD CONFIGURATION ‚ö†Ô∏è
        const CORRECT_PASSWORD = "testing12345"; // Change this to your password
        const REDIRECT_URL = "https://www.google.com"; // Change this to where wrong passwords should redirect

        // FIREBASE CONFIGURATION
        const firebaseConfig = {
            apiKey: "AIzaSyBNaT6APrxbHpu7Gl_NS9FSSKc69xHGRQE",
            authDomain: "mathematicsig.firebaseapp.com",
            databaseURL: "https://mathematicsig-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "mathematicsig",
            storageBucket: "mathematicsig.firebasestorage.app",
            messagingSenderId: "389742861473",
            appId: "1:389742861473:web:f643c438a5f07b8e4364e0"
        };

        // Password check function
        function checkPassword() {
            const input = document.getElementById('topicInput').value;
            
            if (input === CORRECT_PASSWORD) {
                // Correct password - show chat app
                document.getElementById('passwordScreen').classList.add('hidden');
                document.getElementById('chatContainer').classList.add('active');
                
                // Save auth state in sessionStorage (only for this tab/window)
                sessionStorage.setItem('authenticated', 'true');
            } else {
                // Wrong password - redirect
                window.location.href = REDIRECT_URL;
            }
        }

        // Check authentication on page load
        window.addEventListener('load', function() {
            const isAuthenticated = sessionStorage.getItem('authenticated');
            
            if (isAuthenticated === 'true') {
                // Already authenticated in this session
                document.getElementById('passwordScreen').classList.add('hidden');
                document.getElementById('chatContainer').classList.add('active');
            } else {
                // Show password screen
                document.getElementById('topicInput').focus();
            }
        });

        // Allow Enter key on password screen
        document.getElementById('topicInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkPassword();
            }
        });

        // Initialize Firebase
        let app, database, currentRoomRef, messagesRef;
        let currentRoom = '';
        let encryptionKey = '';
        let userName = 'user_' + Math.random().toString(36).substr(2, 9);
        let isInitialized = false;
        let replyingToMessage = null;
        let lastTapTime = 0;
        let lastTapTarget = null;

        try {
            app = firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            isInitialized = true;
        } catch (error) {
            console.error("Firebase initialization error:", error);
        }

        // ENCRYPTION FUNCTIONS
        function encrypt(text, key) {
            try {
                return CryptoJS.AES.encrypt(text, key).toString();
            } catch (error) {
                console.error('Encryption error:', error);
                return null;
            }
        }

        function decrypt(encryptedText, key) {
            try {
                const bytes = CryptoJS.AES.decrypt(encryptedText, key);
                const decrypted = bytes.toString(CryptoJS.enc.Utf8);
                if (!decrypted) {
                    return null;
                }
                return decrypted;
            } catch (error) {
                console.error('Decryption error:', error);
                return null;
            }
        }

        // REPLY FUNCTIONS
        function setReplyingTo(messageId, messageText) {
            replyingToMessage = {
                id: messageId,
                text: messageText
            };
            
            document.getElementById('replyingToText').textContent = `Replying to: ${messageText.substring(0, 50)}${messageText.length > 50 ? '...' : ''}`;
            document.getElementById('replyingBanner').classList.add('active');
            document.getElementById('messageInput').focus();
        }

        function cancelReply() {
            replyingToMessage = null;
            document.getElementById('replyingBanner').classList.remove('active');
        }

        function joinRoom() {
            if (!isInitialized) {
                alert('Firebase is not configured. Please add your Firebase config.');
                return;
            }

            const roomCode = document.getElementById('roomCodeInput').value.trim();
            if (roomCode.length < 6) {
                alert('yo make ur room code at least 6 characters for security fr');
                return;
            }

            currentRoom = roomCode.toUpperCase();
            encryptionKey = roomCode;
            
            document.getElementById('currentRoom').textContent = currentRoom;
            document.getElementById('joinScreen').style.display = 'none';
            document.getElementById('chatScreen').classList.add('active');

            currentRoomRef = database.ref('rooms/' + currentRoom);
            messagesRef = currentRoomRef.child('messages');

            messagesRef.on('child_added', (snapshot) => {
                const encryptedMessage = snapshot.val();
                const messageId = snapshot.key;
                const decryptedMessage = decryptMessage(encryptedMessage);
                
                if (decryptedMessage) {
                    addMessageToUI(decryptedMessage, messageId);
                    scrollToBottom();
                }
            });

            updateStatus();

            const encryptedUserId = encrypt(userName, encryptionKey);
            const presenceRef = currentRoomRef.child('presence').child(encryptedUserId);
            presenceRef.set(true);
            presenceRef.onDisconnect().remove();

            currentRoomRef.child('presence').on('value', (snapshot) => {
                const users = snapshot.val();
                const userCount = users ? Object.keys(users).length : 0;
                updateStatus(userCount);
            });
        }

        function leaveRoom() {
            if (currentRoomRef) {
                const encryptedUserId = encrypt(userName, encryptionKey);
                currentRoomRef.child('presence').child(encryptedUserId).remove();
                messagesRef.off();
                currentRoomRef.off();
            }

            currentRoom = '';
            encryptionKey = '';
            replyingToMessage = null;
            document.getElementById('joinScreen').style.display = 'flex';
            document.getElementById('chatScreen').classList.remove('active');
            document.getElementById('messages').innerHTML = '';
            document.getElementById('roomCodeInput').value = '';
            document.getElementById('replyingBanner').classList.remove('active');
        }

        function updateStatus(userCount = 0) {
            const statusDiv = document.getElementById('status');
            if (userCount > 1) {
                statusDiv.textContent = `üîí yall connected - ${userCount} peeps in here`;
                statusDiv.className = 'status connected';
            } else if (userCount === 1) {
                statusDiv.textContent = '‚è≥ waiting for ur friend to join...';
                statusDiv.className = 'status';
            } else {
                statusDiv.textContent = 'connecting...';
                statusDiv.className = 'status';
            }
        }

        function decryptMessage(encMsg) {
            try {
                const decryptedContent = decrypt(encMsg.content, encryptionKey);
                if (!decryptedContent) return null;

                const decryptedUser = decrypt(encMsg.user, encryptionKey);
                if (!decryptedUser) return null;

                let replyTo = null;
                if (encMsg.replyTo) {
                    const decryptedReplyText = decrypt(encMsg.replyTo.text, encryptionKey);
                    if (decryptedReplyText) {
                        replyTo = {
                            id: encMsg.replyTo.id,
                            text: decryptedReplyText
                        };
                    }
                }

                return {
                    type: encMsg.type,
                    content: decryptedContent,
                    user: decryptedUser,
                    timestamp: encMsg.timestamp,
                    replyTo: replyTo
                };
            } catch (error) {
                return null;
            }
        }

        function addMessageToUI(msg, messageId) {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = msg.user === userName ? 'message own' : 'message other';
            messageDiv.setAttribute('data-message-id', messageId);

            const bubble = document.createElement('div');
            bubble.className = 'message-bubble';

            // Add reply indicator if this is a reply
            if (msg.replyTo) {
                const repliedMsg = document.createElement('div');
                repliedMsg.className = 'replied-message';
                const repliedText = document.createElement('div');
                repliedText.className = 'replied-message-text';
                repliedText.textContent = msg.replyTo.text.substring(0, 50) + (msg.replyTo.text.length > 50 ? '...' : '');
                repliedMsg.appendChild(repliedText);
                bubble.appendChild(repliedMsg);
            }

            // Add main message content
            if (msg.type === 'text') {
                const textNode = document.createTextNode(msg.content);
                bubble.appendChild(textNode);
            } else if (msg.type === 'image') {
                const img = document.createElement('img');
                img.src = msg.content;
                img.alt = 'Shared image';
                img.onclick = () => window.open(msg.content, '_blank');
                bubble.appendChild(img);
            }

            // Add reply arrow
            const replyArrow = document.createElement('div');
            replyArrow.className = 'reply-arrow';
            replyArrow.innerHTML = '‚Ü©';
            replyArrow.onclick = () => setReplyingTo(messageId, msg.content);

            // Double-tap to reply
            bubble.addEventListener('click', function(e) {
                const currentTime = new Date().getTime();
                const tapLength = currentTime - lastTapTime;
                
                if (tapLength < 500 && tapLength > 0 && lastTapTarget === bubble) {
                    // Double tap detected
                    setReplyingTo(messageId, msg.content);
                }
                
                lastTapTime = currentTime;
                lastTapTarget = bubble;
            });

            const timestamp = document.createElement('div');
            timestamp.className = 'timestamp';
            timestamp.textContent = new Date(msg.timestamp).toLocaleTimeString();

            messageDiv.appendChild(replyArrow);
            messageDiv.appendChild(bubble);
            messageDiv.appendChild(timestamp);
            messagesDiv.appendChild(messageDiv);
        }

        function sendMessage() {
            if (!isInitialized || !currentRoom) return;

            const input = document.getElementById('messageInput');
            const imageUrlInput = document.getElementById('imageUrlInput');
            const message = input.value.trim();
            const imageUrl = imageUrlInput.value.trim();

            if (!message && !imageUrl) return;

            if (message) {
                const encryptedMessage = {
                    type: 'text',
                    content: encrypt(message, encryptionKey),
                    user: encrypt(userName, encryptionKey),
                    timestamp: Date.now()
                };

                // Add reply info if replying
                if (replyingToMessage) {
                    encryptedMessage.replyTo = {
                        id: replyingToMessage.id,
                        text: encrypt(replyingToMessage.text, encryptionKey)
                    };
                }

                messagesRef.push(encryptedMessage);
                input.value = '';
                cancelReply();
            }

            if (imageUrl) {
                const encryptedMessage = {
                    type: 'image',
                    content: encrypt(imageUrl, encryptionKey),
                    user: encrypt(userName, encryptionKey),
                    timestamp: Date.now()
                };

                if (replyingToMessage) {
                    encryptedMessage.replyTo = {
                        id: replyingToMessage.id,
                        text: encrypt(replyingToMessage.text, encryptionKey)
                    };
                }

                messagesRef.push(encryptedMessage);
                imageUrlInput.value = '';
                cancelReply();
            }
        }

        function handleImageUpload() {
            const fileInput = document.getElementById('imageInput');
            const file = fileInput.files[0];
            
            if (file && file.type.startsWith('image/')) {
                const statusDiv = document.getElementById('status');
                const originalStatus = statusDiv.textContent;
                statusDiv.textContent = 'encrypting ur pic...';

                const reader = new FileReader();
                reader.onload = function(e) {
                    if (e.target.result.length > 900000) {
                        alert('bruh that image is too big. use a smaller one or just paste the link instead');
                        statusDiv.textContent = originalStatus;
                        return;
                    }

                    const encryptedMessage = {
                        type: 'image',
                        content: encrypt(e.target.result, encryptionKey),
                        user: encrypt(userName, encryptionKey),
                        timestamp: Date.now()
                    };

                    if (replyingToMessage) {
                        encryptedMessage.replyTo = {
                            id: replyingToMessage.id,
                            text: encrypt(replyingToMessage.text, encryptionKey)
                        };
                    }

                    messagesRef.push(encryptedMessage);
                    statusDiv.textContent = originalStatus;
                    cancelReply();
                };
                reader.readAsDataURL(file);
            }
            
            fileInput.value = '';
        }

        function scrollToBottom() {
            const messagesDiv = document.getElementById('messages');
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        window.addEventListener('beforeunload', () => {
            if (currentRoomRef && encryptionKey) {
                const encryptedUserId = encrypt(userName, encryptionKey);
                currentRoomRef.child('presence').child(encryptedUserId).remove();
            }
        });
    </script>
</body>
</html>
